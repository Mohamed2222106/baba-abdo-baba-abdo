<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة الطاولات</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; direction: rtl; background-color: #f8f8f8; }
        header { background: #ff6600; color: white; padding: 15px; font-size: 24px; }
        button { padding: 10px 20px; margin: 5px; background: red; color: white; border: none; cursor: pointer; border-radius: 5px; }
        .table { width: 100px; height: 100px; background: white; border: 2px solid #ff6600; margin: 10px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 8px; }
        .order-item { background: white; padding: 10px; margin: 5px; border: 1px solid #ccc; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <header>
        <h1>إدارة الطاولات</h1>
    </header>

    <main>
        <button onclick="createTables()">إنشاء طاولات</button>
        <button onclick="openMenuPopup()">إدارة المنيو</button>
        <button onclick="showAllOrders()">جميع الأصناف المختارة</button>
        <div id="tablesContainer"></div>
    </main>

    <!-- نافذة إدارة المنيو -->
    <div id="menuPopup" style="display: none;">
        <h2>إدارة المنيو</h2>
        <button onclick="addMenuSection()">إضافة قسم جديد</button>
        <div id="menuSections"></div>
        <button onclick="closeMenuPopup()">إغلاق</button>
    </div>

    <!-- نافذة اختيار الأصناف -->
    <div id="menuSelectionPopup" style="display: none;">
        <h2>اختر صنفًا</h2>
        <div id="menuItems"></div>
        <button onclick="closeMenuSelection()">إغلاق</button>
    </div>

    <!-- صفحة الطاولة -->
    <div id="tablePage" style="display: none;">
        <h2 id="tableTitle"></h2>
        <div id="orderList"></div>
        <h3>المجموع: <span id="totalPrice">0</span> جنيه</h3>
        <button onclick="closeTablePage()">إغلاق</button>
    </div>

    <script>
        function createTables() {
            let num = prompt("كم عدد الطاولات؟");
            if (!num || isNaN(num) || num <= 0) return;
            localStorage.setItem("numTables", num);
            loadTables();
        }

        function loadTables() {
            let num = localStorage.getItem("numTables") || 0;
            let container = document.getElementById("tablesContainer");
            container.innerHTML = "";
            for (let i = 1; i <= num; i++) {
                let table = document.createElement("div");
                table.classList.add("table");
                table.textContent = `طاولة ${i}`;
                table.setAttribute("data-table", i);
                table.addEventListener("click", () => openTable(i));
                container.appendChild(table);
            }
        }

        function openTable(tableNumber) {
            document.getElementById("tablePage").style.display = "block";
            document.getElementById("tableTitle").textContent = `طاولة ${tableNumber}`;
            document.getElementById("orderList").innerHTML = "";
            let orders = JSON.parse(localStorage.getItem(`table_${tableNumber}`)) || [];
            updateTableOrders(tableNumber, orders);
        }

        function closeTablePage() {
            document.getElementById("tablePage").style.display = "none";
        }

        function openMenuSelection(tableNumber) {
            document.getElementById("menuSelectionPopup").style.display = "block";
            let menuItems = JSON.parse(localStorage.getItem("menuSections")) || [];
            let container = document.getElementById("menuItems");
            container.innerHTML = "";
            menuItems.forEach((section) => {
                let div = document.createElement("div");
                div.innerHTML = `<strong>${section.name}</strong>`;
                section.items.forEach((item) => {
                    let button = document.createElement("button");
                    button.textContent = `${item.name} - ${item.price} جنيه`;
                    button.onclick = () => addOrder(tableNumber, item.name, item.price);
                    div.appendChild(button);
                });
                container.appendChild(div);
            });
        }

        function closeMenuSelection() {
            document.getElementById("menuSelectionPopup").style.display = "none";
        }

        function addOrder(tableNumber, itemName, price) {
            let orders = JSON.parse(localStorage.getItem(`table_${tableNumber}`)) || [];
            orders.push({ name: itemName, price: parseFloat(price), note: "", extra: null });
            localStorage.setItem(`table_${tableNumber}`, JSON.stringify(orders));
            updateTableOrders(tableNumber, orders);
            closeMenuSelection();
        }

        function updateTableOrders(tableNumber, orders) {
            let orderList = document.getElementById("orderList");
            orderList.innerHTML = "";
            let totalPrice = 0;

            orders.forEach((order, index) => {
                totalPrice += order.price;
                let div = document.createElement("div");
                div.classList.add("order-item");
                div.innerHTML = `
                    ${order.name} ${order.extra ? `+ ${order.extra}` : ""}
                    (${order.price} جنيه)
                    <button onclick="addExtra(${tableNumber}, ${index})">إضافة صنف</button>
                    <button onclick="addNote(${tableNumber}, ${index})">ملحوظة</button>
                `;
                orderList.appendChild(div);
            });

            document.getElementById("totalPrice").textContent = totalPrice;
        }

        function addExtra(tableNumber, index) {
            openMenuSelection(tableNumber);
            let menuItems = JSON.parse(localStorage.getItem("menuSections")) || [];
            menuItems.forEach((section) => {
                section.items.forEach((item) => {
                    item.onclick = () => {
                        let orders = JSON.parse(localStorage.getItem(`table_${tableNumber}`)) || [];
                        orders[index].extra = item.name;
                        orders[index].price += parseFloat(item.price);
                        localStorage.setItem(`table_${tableNumber}`, JSON.stringify(orders));
                        updateTableOrders(tableNumber, orders);
                    };
                });
            });
        }

        function addNote(tableNumber, index) {
            let choice = prompt("اختر: 1- إسباجتي | 2- مقصوصة");
            if (choice == "1") choice = "إسباجتي";
            else if (choice == "2") choice = "مقصوصة";
            else return;

            let orders = JSON.parse(localStorage.getItem(`table_${tableNumber}`)) || [];
            orders[index].note = choice;
            localStorage.setItem(`table_${tableNumber}`, JSON.stringify(orders));
            updateTableOrders(tableNumber, orders);
        }

        function openMenuPopup() {
            document.getElementById("menuPopup").style.display = "block";
        }

        function closeMenuPopup() {
            document.getElementById("menuPopup").style.display = "none";
        }

        function showAllOrders() {
            alert("🚀 سيتم عرض جميع الأصناف المختارة لاحقًا!");
        }

        loadTables();
    </script>
</body>
</html>
